


# compilation of libUSB
if(APPLE)
  find_library(quicktimeFramework QuickTime)
  find_library(iokitFramework     IOKit)
  find_library(carbonFramework    Carbon)
  find_library(cocoaFramework     Cocoa)
  find_library(systemFramework    System)
  find_library(webkitFramework    Webkit)
  find_library(audioToolboxFramework AudioToolbox)
  find_library(openGLFramework    OpenGL)

  set(PHD_LINK_EXTERNAL ${QuickTime} ${IOKit} ${Carbon} ${Cocoa} ${System} ${Webkit} ${AudioToolbox} ${OpenGL})

  find_program(wxWidgets_CONFIG_EXECUTABLE NAMES "wx-config" PATHS /Users/raffi/Code/EI/usr/local/bin NO_DEFAULT_PATH)
  if(NOT wxWidgets_CONFIG_EXECUTABLE)
    message(FATAL_ERROR "Cannot find wxWidgets_CONFIG_EXECUTABLE: ${wxWidgets_CONFIG_EXECUTABLE}")
  endif()
  
  find_path(CARBON_INCLUDE_DIR Carbon.h)
  message(STATUS "Carbon header found at ${CARBON_INCLUDE_DIR}")
  
  
  
  
  #############################################
  # wxWidgets
  #set(wxWidgets_CONFIG_OPTIONS --prefix=/Users/raffi/Code/EI/usr/local)
  
  find_package(wxWidgets)
  if(NOT wxWidgets_FOUND)
    message(FATAL_ERROR "WxWidget cannot be found. Please use wx-config prefix")
  endif()
  set(PHD_LINK_EXTERNAL ${PHD_LINK_EXTERNAL} ${wxWidgets_LIBRARIES})
  
  
  
  #############################################
  # cfitsio
  if(NOT EXISTS ${CMAKE_SOURCE_DIR}/thirdparties/cfitsio)
    # untar the dependency
    execute_process(${CMAKE_COMMAND} -E tar xzf ${CMAKE_SOURCE_DIR}/thirdparties/cfitsio3370.tar)
  endif()
  
  set(BUILD_SHARED_LIBS OFF)
  set(USE_PTHREADS OFF)
  add_subdirectory(${CMAKE_SOURCE_DIR}/thirdparties/cfitsio)
  
  if(WIN32)
    set(cfitsio_LIB_NAME cfitsio)
  else()
    set(cfitsio_LIB_NAME libcfitsio)
  endif()
  
  include_directories(${CMAKE_SOURCE_DIR}/thirdparties/cfitsio)
  set(PHD_LINK_EXTERNAL ${PHD_LINK_EXTERNAL} ${cfitsio_LIB_NAME})
  
  
  #############################################
  # libusb  
  if(NOT EXISTS ${CMAKE_SOURCE_DIR}/thirdparties/libusb-1.0.9)
    # untar the dependency
    execute_process(${CMAKE_COMMAND} -E tar xjf ${CMAKE_SOURCE_DIR}/thirdparties/libusb-1.0.9.tar.bz2)
  endif()  
  

  set(libusb_dir ${CMAKE_SOURCE_DIR}/thirdparties/libusb-1.0.9/libusb)
  include_directories(${libusb_dir})
  set(libUSB_SRC
    ${libusb_dir}/core.c
    ${libusb_dir}/descriptor.c
    ${libusb_dir}/io.c
    ${libusb_dir}/sync.c
    ${libusb_dir}/libusb.h
    ${libusb_dir}/libusbi.h
    
    ${libusb_dir}/os/darwin_usb.c
    ${libusb_dir}/os/darwin_usb.h
    
    ${libusb_dir}/os/threads_posix.h 
    ${libusb_dir}/os/threads_posix.c
    )
  add_library(libUSB ${libUSB_SRC})
    
    
  if(NOT EXISTS ${CMAKE_SOURCE_DIR}/thirdparties/libusb-compat-0.1.4)
    # untar the dependency
    execute_process(${CMAKE_COMMAND} -E tar xjf ${CMAKE_SOURCE_DIR}/thirdparties/libusb-compat-0.1.4.tar.bz2)
  endif()  
    
  set(libusbcompath_dir ${CMAKE_SOURCE_DIR}/thirdparties/libusb-compat-0.1.4/libusb)
  include_directories(${libusbcompath_dir})
  set(libUSBCompat_SRC
    ${libusb_dir}/core.c
    ${libusb_dir}/libusb.h
    ${libusb_dir}/libusbi.h
  )
  add_library(libUSBCompat ${libUSBCompat_SRC})  
  

endif()


